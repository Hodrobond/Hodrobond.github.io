{"expireTime":9007200850440922000,"key":"transformer-remark-markdown-html-674e1dbda45d7faac9b82383abae65e5-gatsby-remark-prismjs-","val":"<h3>Longest Collatz sequence</h3>\n<blockquote>\n<p>The following iterative sequence is defined for the set of positive integers:<br/><br/>\nn → n/2 (n is even)<br/>\nn → 3n + 1 (n is odd)<br/><br/>\nUsing the rule above and starting with 13, we generate the following sequence:<br/><br/>\n13 → 40 → 20 → 10 → 5 → 16 → 8 → 4 → 2 → 1<br/><br/>\nIt can be seen that this sequence (starting at 13 and finishing at 1) contains 10 terms. Although it has not been proved yet (Collatz Problem), it is thought that all starting numbers finish at 1.<br/>\nWhich starting number, under one million, produces the longest chain?<br/>\nNOTE: Once the chain starts the terms are allowed to go above one million.</p>\n</blockquote>\n<p>Brute force:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">getCollatzChainLength</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> chain <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> chainCount <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>n <span class=\"token operator\">!==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    chainCount<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">%</span><span class=\"token number\">2</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n      n <span class=\"token operator\">*=</span> <span class=\"token number\">0.5</span>\n    <span class=\"token keyword\">else</span>\n      n <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token operator\">*</span>n<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> chainCount<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getSolution</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> n <span class=\"token operator\">=</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> bestLength <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> bestNum <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i<span class=\"token operator\">=</span>n<span class=\"token punctuation\">;</span> i<span class=\"token operator\">></span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">--</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> chain <span class=\"token operator\">=</span> <span class=\"token function\">getCollatzChainLength</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>chain <span class=\"token operator\">></span> bestLength<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      bestLength <span class=\"token operator\">=</span> chain<span class=\"token punctuation\">;</span>\n      bestNum <span class=\"token operator\">=</span> i<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> bestNum<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Runtime (average of 100 iterations):<br/>\n2209.2250000000004 ms</p>\n<p>Now let's see what we can improve about this. Maybe something along the line of caching our previous Collatz lengths?<br/>\nLet's look at the number <code class=\"language-text\">13</code>, which has a length of 10. When we get to 26, we need to recalculate all 10 links of the 13 chain. That looks like it could be improved! Maybe with something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> collatzLength <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">getCollatzChainLength</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>collatzLength<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> collatzLength<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">%</span><span class=\"token number\">2</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> length <span class=\"token operator\">=</span> <span class=\"token function\">getCollatzChainLength</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">*</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    collatzLength<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> length<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> length<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> length <span class=\"token operator\">=</span> <span class=\"token function\">getCollatzChainLength</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token operator\">*</span>n<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    collatzLength<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> length<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> length<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Updated runtime (average of 100 iterations):<br/>\n1191.455 ms</p>\n<p>Well, caching was faster, let's actually figure out a quantitative value for how many calculations we let the computer skip!<br/>\nIf we add <code class=\"language-text\">var skippedLength = 0</code> as a global var and update the following line:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>collatzLength<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  skippedLength <span class=\"token operator\">+=</span> collatzLength<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> collatzLength<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We can see exactly how many chain iterations we skipped:<br/><code class=\"language-text\">67,631,017</code>.<br/>How many there were total:<br/><code class=\"language-text\">69,799,628</code>.<br/>Which means there was only <code class=\"language-text\">2,168,611</code> unique chain numbers and we skipped about 97% of recalculations!<br/>\nIf we skipped 97% of calculations, why does it still take 50%~ as long though, shouldn't that number be closer to...3%?<br/>\nIt looks like array manipulation takes up the remainder of our boost, our chain array has a length of <code class=\"language-text\">4,286,786,813</code>, and manipulating arrays of that size definitely takes some effort.</p>\n<p>My Naivete is showing, nothing else is jumping at me eager for efficiency.</p>"}